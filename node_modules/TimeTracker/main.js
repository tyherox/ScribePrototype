/**
 * Tyherox
 *
 * TimeWidget
 *
 * The TimeWidget is a simple widget used to tell time. Expanding adds the functionality of showing seconds
 */
function TimeTrackerWidget(){

    var fileref = document.createElement("link")
    fileref.setAttribute("rel", "stylesheet")
    fileref.setAttribute("type", "text/css")
    fileref.setAttribute("href", "node_modules/packages/TimeTracker/style.css")
    document.getElementsByTagName("head")[0].appendChild(fileref)

    //Create TimeWidget HTML Elements
    var time = document.createElement('div');
    time.className = 'timeTracker';
    time.style.fontSize = cellWidth/3 + "px";

    //Build widget
    var widget = new Widget("Time", 4, time);
    this.widget = widget;

    var toolbar = widget.toolbar;
    toolbar.addButton(toolbar.exit());
    toolbar.addButton(toolbar.pin());

    widget.initialize();
    widget.setMaxSize(2,2);

    //Relevant functions
    function updateElement(){
        updateTime();
        setTimeout(arguments.callee, 1000);
    };

    function updateTime(){
        var width = Math.round(widget.element.getBoundingClientRect().width/(cellWidth-cellOffset));

        var date = new Date();
        var hours = date.getHours();
        if(hours<10) hours = "0" + hours;
        var minutes = date.getMinutes();
        if(minutes<10) minutes = "0" + minutes;
        var seconds = date.getSeconds();
        if(seconds<10) seconds = "0" + seconds;
        if(width == 1) time.textContent = "Timer";
        if(width == 2) time.textContent = "Timer";
    };
    updateElement();

    //Resize Listener to show appropriate functionality (HH/MM or HH/MM/SS)
    widget.resizeListener = function(){

        var height = Math.round(widget.container.getBoundingClientRect().height);

        time.style.lineHeight = height + "px";

        var date = new Date();
        var hours = date.getHours();
        if(hours<10) hours = "0" + hours;
        var minutes = date.getMinutes();
        if(minutes<10) minutes = "0" + minutes;
        var seconds = date.getSeconds();
        if(seconds<10) seconds = "0" + seconds

        if(widget.width == 1) time.textContent = hours + ":" + minutes;
        if(widget.width == 2) time.textContent = hours + ":" + minutes +":" + seconds;

        updateTime();
    };
}

module.exports = new TimeTrackerWidget();